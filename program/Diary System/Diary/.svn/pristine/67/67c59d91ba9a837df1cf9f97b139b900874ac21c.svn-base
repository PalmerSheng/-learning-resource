layui.use(['table','form','jquery','layer'], function(){
	var table = layui.table;
	var form = layui.form;
	var $ = layui.jquery;
	var layer = layui.layer;
	var saveUrl = post + "/userInfoUtil/updateUserInfo";
	var delUrl = post + "/userInfoUtil/delUser";
	var selectUrl = post + "/userInfoUtil/selectUserInfo";
	var addUserUrl  = post + "/userInfoUtil/addUser";

	table.on('tool(test)',function(obj){
		var data = obj.data; //获得当前行数据
		var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
		var tr = obj.tr; //获得当前行 tr 的DOM对象




		if(layEvent == 'save'){
			layer.confirm('是否保存更改信息？',{
				btn: ['是','否'],
				yes: function(index){
					_ajax($,saveUrl,{

						usercode : data.usercode,
						password: data.password,
						nickname: data.nickname,
						usertype:$("#type_toggle").val(),
						state:$("#state_toggle").val()
						/*data:data*/

					},function(res){

						if(res.code == "1" ){
							layer.alert(res.message);

						}else if(res.code == "0" ){
							layer.alert("保存成功");
							layer.close(index);
							initTable();
						}else{
							layer.alert("发生意外错误");
						}

					})
				},
				btn2: function(index){
					layer.close(index);
				}
			})
		};
		if(layEvent == 'del'){
			layer.confirm('是否删除该账号？',{
				btn: ['是','否'],
				yes: function(index){
					_ajax($,delUrl,{

						usercode: data.usercode
					},function(res){
						if(res.code == "1" ){
							layer.alert(data.message);

						}else if(res.code == "0" ){
							layer.alert("删除成功");
							initTable();
							layer.close(index);
						}else{
							layer.alert("发生意外错误");
						}

					})
				},
				btn2: function(index){
					layer.close(index)
				}
			})
		} ;

	});

//	加载表格
	function initTable(){
		var init =   table.render({
			elem: '#info-box'
				,height: 315
				,url: '/Activity/luckDraw/getCustomerInfo' //数据接口
					,page: true //开启分页
					,id:'info_table'
						,cols: [[ //表头

						          {field: 'id', title: '序号', width:80, templet: '#number'}
						          ,{field: 'usercode', title: '账号', width:80}
						          ,{field: 'password', title: '密码', width:80,edit:'text' }
						          ,{field: 'nickname', title: '昵称', width:80,edit:'text'} 
						          ,{field: 'awardcode', title: '奖品号', width: 80,edit:'text'}
						          ,{field: 'usertype', title: '用户类型', minWidth:100,width: 120 ,templet:'#user_sort'}
						          ,{field: 'state', title: '账号状态', width: 120,templet:'#state_sort'}
						          ,{field: 'lasttime', title: '上次登录', width: 240}
						          ,{field: 'starttime', title: '注册时间'}
						          ,{field: '',title:"操作",toolbar:"#barDemo"}

						          ]]

		,limit: 10
		,where: {                       //接口的其他参数
			usercode:$("#usercode").val(),
			nickname: $("#nickname").val(),
			usertype:$("#usertype").val()


		},
		done: function (data) {         //回调函数
			form.render('select'); 
		}
						          });
		}
		initTable();

		$("#query_btn").on('click',function(){
			initTable();
		})

		form.on('select(usertype_box)', function(data){
			initTable();
		});      


		$('#addUser').on('click', function(){
			layer.open({
				type: 1,
				title: '添加用户',
				area: ['450px', '320px'],
				shadeClose: true,
				content: $('#addUser_content'),
				btn: ["创建","取消"],
				yes: function(father_index){
					layer.confirm('是否创建该用户？',{
						btn: ['是','否'],
						yes: function(index){
							_ajax($,addUserUrl,{
								usercode: $("#add_usercode").val(),
								password: $("#add_password").val(),
								nickname: $("#add_nickname").val(),
								usertype: $("#add_usertype").val()
							},function(res){

								layer.alert("创建成功");
								initTable();
								layer.close(index)
								layer.close(father_index);

							})
						},
						btn2: function(index){
							layer.close(index)
						}
					})
				},
				btn2: function(index){
					layer.close(index)
				}
			});
		});



	});




