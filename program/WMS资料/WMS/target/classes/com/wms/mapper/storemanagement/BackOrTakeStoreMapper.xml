<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wms.mapper.storemanagement.BackOrTakeStoreMapper">

	<select id="selGoods" resultType="com.wms.model.BackOrTakeModel">
		SELECT
		id,
		goods_code,
		goods_num
		FROM
		goods
		WHERE
		goods_code = #{goods_code}
	</select>
	
	<!-- 退货 -->
	<insert id="backStore01">
	<!--相当于for循环，依次查找与数据库相匹配的数据，并且进行更新 -->
		<foreach collection="list" item="item" index="index" open=""
			close="" separator=";">
			INSERT INTO takeinfo (
			id,
			goods_code,
			goods_num,
			take_code,
			duty_code,
			time,
			take_state,
			state
			)
			VALUES
			(
			NULL,#{item.goods_code},#{item.goods_num},#{item.take_code},
			#{item.duty_code},#{time},#{item.take_state},#{item.state})
		</foreach>
	</insert>

	<update id="backStore02">
		<!--相当于for循环，依次查找与数据库相匹配的数据，并且进行更新 -->
		<foreach collection="list" item="item" index="index" open=""
			close="" separator=";">
			UPDATE goods
			SET goods_num = goods_num + #{item.goods_num},time=#{time}
			WHERE
			goods_code = #{item.goods_code}
		</foreach>
	</update>

	<!-- 取货 -->
	<insert id="takeStore01">
	<!--相当于for循环，依次查找与数据库相匹配的数据，并且进行更新 -->
		<foreach collection="list" item="item" index="index" open=""
			close="" separator=";">
			INSERT INTO takeinfo (
			id,
			goods_code,
			goods_num,
			take_code,
			duty_code,
			time,
			take_state,
			state
			)
			VALUES
			(
			NULL,#{item.goods_code},#{item.goods_num},#{item.take_code},
			#{item.duty_code},#{time},#{item.take_state},#{item.state})
		</foreach>
	</insert>

	<update id="takeStore02">
		<!--相当于for循环，依次查找与数据库相匹配的数据，并且进行更新 -->
		<foreach collection="list" item="item" index="index" open=""
			close="" separator=";">
			UPDATE goods
			SET goods_num = goods_num - #{item.goods_num},time=#{item.time}
			WHERE
			goods_code = #{goods_code}
		</foreach>
	</update>

	<select id="takeStore03" resultType="com.wms.model.BackOrTakeModel">
		<foreach collection="list" item="item" index="index" open=""
			close="" separator=";">
		SELECT
		goods_num,goods_code
		FROM goods
		where
		goods_code=#{item.goods_code}
		</foreach>
	</select>
</mapper>